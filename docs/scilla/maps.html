<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<title data-react-helmet="true">Maps | TLDR Zilliqa DApp Course</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://teye.github.io/zilliqa-tldr-dapp-course/docs/scilla/maps"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Maps | TLDR Zilliqa DApp Course"><meta data-react-helmet="true" name="description" content="In Scilla, Maps and Lists are two of the core data types that can store complex data. In particular, Maps are more widely used in almost all of the contracts."><meta data-react-helmet="true" property="og:description" content="In Scilla, Maps and Lists are two of the core data types that can store complex data. In particular, Maps are more widely used in almost all of the contracts."><link data-react-helmet="true" rel="shortcut icon" href="/zilliqa-tldr-dapp-course/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://teye.github.io/zilliqa-tldr-dapp-course/docs/scilla/maps"><link data-react-helmet="true" rel="alternate" href="https://teye.github.io/zilliqa-tldr-dapp-course/docs/scilla/maps" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://teye.github.io/zilliqa-tldr-dapp-course/docs/scilla/maps" hreflang="x-default"><link rel="stylesheet" href="/zilliqa-tldr-dapp-course/assets/css/styles.a2a31263.css">
<link rel="preload" href="/zilliqa-tldr-dapp-course/assets/js/runtime~main.9a777267.js" as="script">
<link rel="preload" href="/zilliqa-tldr-dapp-course/assets/js/main.e4191d21.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://docusaurus.io/" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/zilliqa-tldr-dapp-course/img/hexagon.svg" alt="Site Logo" class="themedImage_TMUO themedImage--light_4Vu1" height="32" width="32"><img src="/zilliqa-tldr-dapp-course/img/hexagon_light.svg" alt="Site Logo" class="themedImage_TMUO themedImage--dark_uzRr" height="32" width="32"></div><b class="navbar__title">Home</b></a><a class="navbar__item navbar__link navbar__link--active" href="/zilliqa-tldr-dapp-course/docs/intro">Developing DApp on Zilliqa</a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleChecked_a04y toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" checked="" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Start Here</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Chapter 1: Sciila</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zilliqa-tldr-dapp-course/docs/scilla/intro">Scilla Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zilliqa-tldr-dapp-course/docs/scilla/transitions_procedures">Transitions &amp; Procedures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zilliqa-tldr-dapp-course/docs/scilla/maps">Maps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zilliqa-tldr-dapp-course/docs/scilla/events_errors">Events &amp; Errors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zilliqa-tldr-dapp-course/docs/scilla/custom_adts">Custom ADT(s)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zilliqa-tldr-dapp-course/docs/scilla/remote_state_reads">Remote State Reads</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Chapter 2: Zilliqa API &amp; ZilliqaJS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Chapter 3: React DApp Development</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Maps</h1></header><p>In Scilla, <code>Maps</code> and <code>Lists</code> are two of the core data types that can store complex data. In particular, <code>Maps</code> are more widely used in almost all of the contracts.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="declaration">Declaration<a aria-hidden="true" class="hash-link" href="#declaration" title="Direct link to heading">â€‹</a></h2><p>To declare a new map, we defined it as a mutable field in the contract and assigned a <code>Type</code> for the key and value which it can hold. We also assigned an empty map - denoted by <code>Emp</code> to the new map field.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="syntax">Syntax<a aria-hidden="true" class="hash-link" href="#syntax" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">contract ContractName()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  field map_name: Map Type1 Type2 = Emp Type1 Type2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>Note:</strong></p><ul><li><code>Type1</code> and <code>Type2</code> can be the same type.</li><li>Nested maps are possible.</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example">Example<a aria-hidden="true" class="hash-link" href="#example" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">contract CryptoMon()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (* Mapping of token_id -&gt; owner_address *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  field token_owners: Map Uint256 ByStr20 = Emp Uint256 ByStr20</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the above example, <code>token_owners</code> is a map <code>Uint256 -&gt; ByStr20</code> the key is of type <code>Uint256</code> and the value is of type <code>ByStr20</code>, the contract state would look like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">token_owners </span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;1&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x1234567890123456789012345678901234567890&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;2&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x1234567890123456789012345678901234567890&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="add--overwrite-map-entries">Add / Overwrite Map Entries<a aria-hidden="true" class="hash-link" href="#add--overwrite-map-entries" title="Direct link to heading">â€‹</a></h2><p>To add a new map entry, assign a new key and value to the map. This is also known as in-place access.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="syntax-1">Syntax<a aria-hidden="true" class="hash-link" href="#syntax-1" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition transitionName()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    map_name[key] := value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example-1">Example<a aria-hidden="true" class="hash-link" href="#example-1" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition AddMap(id: Uint256, address: ByStr20)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    token_owners[id] := address</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the above example, the <code>AddMap()</code> transition takes in an <code>id</code> and <code>address</code> and updates the <code>token_owners</code> map. This allow us to overwrite existing map entries with new values.</p><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</h5></div><div class="admonition-content"><p>Always update the map <strong>in-place</strong>.
Do not copy a new map, update the map and re-assigned it back! </p><p>This is slow and consumes a lot of gas!</p><p>DON&#x27;T DO THIS:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition AddMap(id: Uint256, address: ByStr20)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_token_owners &lt;- token_owners;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_token_owners[id] := address;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    token_owners := new_token_owners</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="delete-map-entries">Delete Map Entries<a aria-hidden="true" class="hash-link" href="#delete-map-entries" title="Direct link to heading">â€‹</a></h2><p>To delete a map entry, simply use the <code>delete</code> keyword on the particular map entry.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="syntax-2">Syntax<a aria-hidden="true" class="hash-link" href="#syntax-2" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition transitionName()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    delete map_name[key]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example-2">Example<a aria-hidden="true" class="hash-link" href="#example-2" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition DeleteMap(id: Uint256)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    delete token_owners[id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The above example deletes the specific <code>token_owners[id]</code> entry from the map. </p><p>If a map is empty, the contract state would look like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  token_owners</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="improve-add--delete-map-entries">Improve Add / Delete Map Entries<a aria-hidden="true" class="hash-link" href="#improve-add--delete-map-entries" title="Direct link to heading">â€‹</a></h2><p>Now, we can improve the adding and deleting of map entries by putting additional checks.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="add-map-example-with-checks">Add Map Example with Checks<a aria-hidden="true" class="hash-link" href="#add-map-example-with-checks" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition AddMap(id: Uint256, address: ByStr20)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    owner &lt;- token_owners[id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    match owner with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | Some existing_owner =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      (* owner already exists for this token_id; do nothing or throw error *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | None =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      (* no such owner; proceed to add *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      token_owners[id] := address</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>First, we tried to fetch an owner for the <code>id</code> supplied by the user. Next we use the <code>match owner with</code> syntax to check whether any owner address is being fetched. The new item is added into the map only if the <code>id</code> is not already owned by anyone yet. If it is already owned, we do not want to overwrite the map.</p><p>In other languages, the logic can be interpreted as such:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  const owner = token_owners[id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if (owner !== undefined) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // do nothing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  } else {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // add to map</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    token_owners[id] = owner;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="delete-map-example-with-checks">Delete Map Example with Checks<a aria-hidden="true" class="hash-link" href="#delete-map-example-with-checks" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition DeleteMap(id: Uint256)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    owner &lt;- token_owners[id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    match owner with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | Some existing_owner =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      (* owner exists for this token_id; proceed to delete *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      delete token_owners[id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | None =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      (* no such owner for this token_id to delete; throw error *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Similar to the above add map example, first, we attempt to fetch an <code>owner</code> for this <code>id</code> that we wish to delete. Next. we check whether if this <code>owner</code> is undefined or not. If <code>owner</code> is undefined as shown by the <code>| None =&gt;</code> branch, that implies the <code>id</code> does not exists in <code>token_owners</code> map. If <code>owner</code> is defined, then we proceed to delete the <code>id</code> from <code>token_owners</code>.</p><p>In other languages, the logic can be interpeted as such:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  const owner = token_owners[id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if (owner !== undefined) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // delete from map</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    delete token_owners[id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  } else {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // throw error</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><br><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>You might have noticed that we have added the comments &quot;throw error&quot; in the example code. </p><p>The topic on throwing errors and emiting events is covered in the next section <a href="/zilliqa-tldr-dapp-course/docs/scilla/events_errors"><strong>Events &amp; Errors</strong></a>.</p></div></div><br><br><header><h1>Intermediate - Nested Maps (Optional)</h1></header><p>Nested maps are maps whose value point to a key of the second map. There is no limit to the number of nesting levels.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="nested-maps---declaration">Nested Maps - Declaration<a aria-hidden="true" class="hash-link" href="#nested-maps---declaration" title="Direct link to heading">â€‹</a></h2><p>Identical to how we declare a non-nested map, we first define a mutable field in the contract and assigned a <code>Type</code> for the key and value which it can hold. We also assigned an empty map - denoted by <code>Emp</code> to the new map field.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="syntax-3">Syntax<a aria-hidden="true" class="hash-link" href="#syntax-3" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">contract ContractName()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  field map_name: Map Type1 (Map Type2 Type3) = Emp Type1 (Map Type2 Type3)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example-3">Example<a aria-hidden="true" class="hash-link" href="#example-3" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">contract SuperMarket()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (* Mapping of category_id -&gt; product_id -&gt; name *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  field products: Map Uint256 (Map Uint256 String) = Emp Uint256 (Map Uint256 String)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the above example, <code>products</code> is a map <code>Uint256 -&gt; (Map Uint256 String)</code> the key is of type <code>Uint256</code> and the value is of type <code>Map</code>. Within the nested map, we have <code>Uint256 -&gt; String</code> </p><p>the contract state would look like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">products </span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;1&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;42&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;red apple&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;43&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;green apple&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;44&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;orange&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;2&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;27&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;celery&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;28&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;spinach&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;29&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;cabbage&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="nested-maps---add--overwrite-entries">Nested Maps - Add / Overwrite Entries<a aria-hidden="true" class="hash-link" href="#nested-maps---add--overwrite-entries" title="Direct link to heading">â€‹</a></h2><p>Adding an entry into a nested map is identical to the non-nested one.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="syntax-4">Syntax<a aria-hidden="true" class="hash-link" href="#syntax-4" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition transitionName()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    map_name[key1][key2] := value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example-4">Example<a aria-hidden="true" class="hash-link" href="#example-4" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition AddMap(category_id: Uint256, product_id: Uint256, name: String)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    products[category_id][product_id] := name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="nessted-maps---delete-entries">Nessted Maps - Delete Entries<a aria-hidden="true" class="hash-link" href="#nessted-maps---delete-entries" title="Direct link to heading">â€‹</a></h2><p>Deleting an entry from a nested map is identical to the non-nested one.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="syntax-5">Syntax<a aria-hidden="true" class="hash-link" href="#syntax-5" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition transitionA()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    delete map_name[key1][key2]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition transitionB()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    delete map_name[key1]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example-5">Example<a aria-hidden="true" class="hash-link" href="#example-5" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition DeleteA(category_id: Uint256, product_id: Uint256)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    delete products[category_id][product_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition DeleteB(category_id: Uint256)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    delete products[category_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the above examples, the first transition <code>DeleteA</code> deletes a specific entry from the nested map. However in <code>DeleteB</code>, the transition <strong>deletes the entire nested map</strong>.</p><p>Here is how the contract state would look like if we execute both transitions:</p><p>Suppose the initial contract state is:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">products : {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;1&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;42&quot;: &quot;red apple&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;43&quot;: &quot;green apple&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;44&quot;: &quot;orange&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;2&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;27&quot;: &quot;celery&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;28&quot;: &quot;spinach&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;29&quot;: &quot;cabbage&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If we call <code>DeleteA(1, 42)</code>, the state would become this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">products : {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;1&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;43&quot;: &quot;green apple&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;44&quot;: &quot;orange&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;2&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;27&quot;: &quot;celery&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;28&quot;: &quot;spinach&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;29&quot;: &quot;cabbage&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Observe that the entry <code>42 -&gt; red apple</code> has been deleted.</p><p>If we call <code>DeleteB(1)</code>, the state would become this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">products : {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;2&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;27&quot;: &quot;celery&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;28&quot;: &quot;spinach&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;29&quot;: &quot;cabbage&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Observe that the entires <code>1 -&gt; { ... }</code> has been deleted.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="proper-nested-maps-deletion">Proper Nested Maps Deletion<a aria-hidden="true" class="hash-link" href="#proper-nested-maps-deletion" title="Direct link to heading">â€‹</a></h3><p>Usually when we delete a map entry, we would delete only a specifc <code>key-value</code> pair. For nested maps, this may result in a lot of empty map states.</p><p>Suppose we have the following map:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">products : {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;1&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;42&quot;: &quot;red apple&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;43&quot;: &quot;green apple&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;44&quot;: &quot;orange&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;45&quot;: ...,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;46&quot;: ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;100&quot;: &quot;cherry&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;2&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;3&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If we continously delete an entry from &quot;1&quot;, example, delete <code>42 -&gt; red apple</code>, next delete <code>43 -&gt; green apple</code>, etc. Then the map would have an empty state when all the items within category &quot;1&quot; is deleted:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">products : {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;1&quot;: {},  &lt;-- empty map state</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;2&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;3&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If we have many product categories and we perform many entry deletion from a nested map, we would end up with map empty map states!</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">products : {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;1&quot;: {},  &lt;-- empty map state</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;2&quot;: {},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;3&quot;: {},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;4&quot;: {},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;999&quot;: {},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;1000&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;20&quot;: &quot;jam&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>These empty states would slow down the time taken to fetch the contract state! </p><p>Hence, we need to delete the &quot;outer layer&quot; in the map once the inner nested entries have all been deleted.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example-6">Example<a aria-hidden="true" class="hash-link" href="#example-6" title="Direct link to heading">â€‹</a></h4><p>In order to delete the &quot;outer layer&quot; map, we need to add the following checks:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (* Library *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  import ListUtils IntUtils</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let uint32_zero = Uint32 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (* check if nested maps are empty *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let is_products_map_empty =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fun(m : Map Uint256 String) =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      let map_size = builtin size m in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      builtin eq map_size uint32_zero</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (***************************************************)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (*             The contract definition             *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (***************************************************)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  contract SuperMarket()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (* Deletes the category if the nested map is empty *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  procedure DeleteCategory(category_id: Uint256)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    products_map &lt;- products[category_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    match products_map with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | Some products_entry =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      is_map_empty = is_products_map_empty products_entry;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      match is_map_empty with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      | True =&gt; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (* empty map *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        delete products[category_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      | False =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (* contains other records *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | None =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (* nothing to delete *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transition DeleteProduct(category_id: Uint256, product_id: Uint256)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    delete products[category_id][product_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    DeleteCategory category_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Let&#x27;s start with the transition <code>DeleteProduct</code>. <code>DeleteProduct</code> deletes a specifc nested map entry <code>products[category_id][product_id</code>. After the deletion, it calls the procedure <code>DeleteCategory</code>.</p><p>Inside <code>DeleteCategory</code>, the transition checks if there exists other nested map entries. Since we have deleted one entry in <code>DeleteProduct</code>, we need to consider if there are other <code>product_id</code> within the same <code>category_id</code>, for example:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">products</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;1&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;43&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;green apple&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;44&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;orange&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This check is done by <code>is_map_empty = is_products_map_empty products_entry;</code>. We code our own library function <code>is_products_map_empty</code> before the contract definition section.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let is_products_map_empty =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fun(m : Map Uint256 String) =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      let map_size = builtin size m in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      builtin eq map_size uint32_zero</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>What <code>is_products_map_empty</code> does is to take in <code>products[1]</code> and calculate the size of this map; something like <em>&quot;array.size()&quot;</em> in other languages. The function <code>is_products_map_empty</code> returns <code>True</code> if <code>products[1]</code> is empty and <code>False</code> otherwise. </p><p>In the above example, <code>products[1]</code> has 2 other nested map entries <code>43 -&gt; green apple</code> and <code>44 -&gt; orange</code>. So the function <code>is_products_map_empty</code> will return <code>False</code>.</p><p>Next, we will <code>delete products[1]</code> if <code>products[1]</code> is empty:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (* Deletes the category if the nested map is empty *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  procedure DeleteCategory(category_id: Uint256)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    products_map &lt;- products[category_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    match products_map with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | Some products_entry =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      is_map_empty = is_products_map_empty products_entry;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      match is_map_empty with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      | True =&gt; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (* empty map *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        delete products[category_id]    &lt;-- delete the &quot;outer&quot; layer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      | False =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (* contains other records *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | None =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (* nothing to delete *)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To summarize, for proper maps deletion in <strong>nested maps</strong>, we code our own <code>DeleteProduct</code> transition that not only deletes the nested map entry but also the outer layer if the inner layer is empty after the deletion of the nested map entry.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="exercises">Exercises<a aria-hidden="true" class="hash-link" href="#exercises" title="Direct link to heading">â€‹</a></h2><p>The following are some exercises to help you be familiar with maps.</p><p><strong>Instructions</strong></p><ul><li>Download this <a href="https://github.com/teye/zilliqa-tldr-dapp-course/blob/main/exercises/chapter1/ch01_cryptomon.scilla" target="_blank" rel="noopener noreferrer"><strong>Cryptomon Contract</strong></a> to get started.</li></ul><p><strong>Task 1</strong></p><ul><li>Define a new map <code>token_owners</code> (<code>Uint256</code> -&gt; <code>ByStr20</code>) that stores the mapping of <code>token_id</code> to users&#x27; wallet addresses.</li><li>Define a new transition <code>AddCryptoMon</code> that takes in <code>token_id</code> and <code>address</code> and add the new entry into the <code>token_owners</code> map.</li><li>Define a new transition <code>DeleteCryptoMon</code> that deletes a specific <code>token_id</code> from <code>token_owners</code>.</li></ul><p><strong>Task 2</strong></p><p>Deploy the contract on <a href="https://ide.zilliqa.com/" target="_blank" rel="noopener noreferrer"><strong>Neo-Savant IDE</strong></a> on <strong>Testnet</strong> and execute <code>AddCryptoMon(wallet_address)</code>. </p><p>Once the transaction is confirmed, execute <code>AddItem(wallet_address)</code> a second time with a different <code>token_id</code>. </p><p>Look at the deployed contract state on <strong>ViewBlock</strong>.</p><p>The contract state should look something like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">token_owners </span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;1&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x&lt;wallet_address&gt;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;2&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x&lt;wallet_address&gt;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>Task 3</strong></p><p>Return back to Neo-Savant IDE, execute <code>DeleteCryptoMon</code> on <code>token_id</code> - <strong>1</strong>. </p><p>Check the <code>token_owners</code> state again on ViewBlock.</p><p>It should look like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">token_owners </span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;2&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x&lt;wallet_address&gt;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/teye/zilliqa-tldr-dapp-course/docs/scilla/maps.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zilliqa-tldr-dapp-course/docs/scilla/transitions_procedures"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Transitions &amp; Procedures</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zilliqa-tldr-dapp-course/docs/scilla/events_errors"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Events &amp; Errors<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#declaration" class="table-of-contents__link toc-highlight">Declaration</a></li><li><a href="#add--overwrite-map-entries" class="table-of-contents__link toc-highlight">Add / Overwrite Map Entries</a></li><li><a href="#delete-map-entries" class="table-of-contents__link toc-highlight">Delete Map Entries</a></li><li><a href="#improve-add--delete-map-entries" class="table-of-contents__link toc-highlight">Improve Add / Delete Map Entries</a></li><li><a href="#nested-maps---declaration" class="table-of-contents__link toc-highlight">Nested Maps - Declaration</a></li><li><a href="#nested-maps---add--overwrite-entries" class="table-of-contents__link toc-highlight">Nested Maps - Add / Overwrite Entries</a></li><li><a href="#nessted-maps---delete-entries" class="table-of-contents__link toc-highlight">Nessted Maps - Delete Entries</a><ul><li><a href="#proper-nested-maps-deletion" class="table-of-contents__link toc-highlight">Proper Nested Maps Deletion</a></li></ul></li><li><a href="#exercises" class="table-of-contents__link toc-highlight">Exercises</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021. Built with Docusaurus.</div></div></div></footer></div>
<script src="/zilliqa-tldr-dapp-course/assets/js/runtime~main.9a777267.js"></script>
<script src="/zilliqa-tldr-dapp-course/assets/js/main.e4191d21.js"></script>
</body>
</html>